<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.moa.trip.mapper.TripMapper">

    <!--    사용자가 생성하거나 참여한 여행 총 개수-->
    <select id="countTripsByMemberId" resultType="int">
        SELECT COUNT(*)
        FROM trip t
                 INNER JOIN trip_member tm ON t.trip_id = tm.trip_id
        WHERE tm.member_id = #{memberId}
    </select>
    <!--    사용자가 생성하거나 참여한 여행 페이징 된 리스트-->
    <select id="getTripsByMemberIdPaged" resultType="org.moa.trip.dto.trip.TripListResponseDto">
        SELECT
            t.trip_id     AS tripId,
            t.trip_name   AS tripName,
            t.start_date  AS startDate,
            t.end_date    AS endDate,
            t.trip_location AS locationName
        FROM
            trip t
                INNER JOIN trip_member tm ON t.trip_id = tm.trip_id
        WHERE
            tm.member_id = #{memberId}
        ORDER BY
            t.start_date DESC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <select id="selectTripById" resultType="org.moa.trip.entity.Trip">
        SELECT *
        FROM TRIP
        WHERE trip_id = #{tripId}
    </select>
    <insert id="insert" parameterType="org.moa.trip.entity.Trip" useGeneratedKeys="true" keyProperty="tripId">
        INSERT INTO TRIP (member_id,
                          trip_name,
                          trip_location,
                          start_date,
                          end_date,
                          created_at,
                          updated_at
        )
        VALUES (#{memberId},
                #{tripName},
                #{tripLocation},
                #{startDate},
                #{endDate},
                #{createdAt},
                #{updatedAt}
               )
    </insert>
</mapper>
